<!DOCTYPE html>
<html lang="ht">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prisme - Admin Control</title>
    <style>
        :root {
            --bg: #0B0E14;
            --card-bg: #161B22;
            --primary: #3B82F6;
            --accent: #10B981;
            --text: #F9FAFB;
            --danger: #EF4444;
            --modal-bg: rgba(0, 0, 0, 0.95);
        }

        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            padding-bottom: 80px;
        }

        .header { 
            padding: 15px; 
            text-align: center; 
            background: #111827;
            border-bottom: 2px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-categories { 
            display: flex; 
            overflow-x: auto; 
            padding: 10px; 
            gap: 8px; 
            background: #0B0E14;
            border-bottom: 1px solid #30363D;
            scrollbar-width: none;
        }

        .nav-categories button { 
            background: var(--card-bg); 
            border: 1px solid #30363D; 
            color: #8B949E; 
            padding: 8px 16px; 
            border-radius: 6px; 
            cursor: pointer; 
            white-space: nowrap;
            font-weight: 600;
        }

        .nav-categories button.active { background: var(--primary); color: white; border-color: var(--primary); }

        #display-area { padding: 15px; max-width: 500px; margin: auto; }

        .card { 
            background: var(--card-bg); 
            padding: 15px; 
            margin-bottom: 15px; 
            border-radius: 12px; 
            border: 1px solid #30363D;
        }

        .user-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        
        /* Styl pou foto pwofil ak pr√®v match */
        .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
            background: #21262d;
        }

        .img-preview {
            width: 100%;
            max-height: 300px;
            margin-top: 10px;
            border-radius: 8px;
            cursor: pointer;
            object-fit: contain;
            background: #000;
            display: block; /* Asire li pran plas li */
        }

        .info { font-size: 13px; color: #8B949E; line-height: 1.6; }
        .amount { color: var(--accent); font-weight: bold; }

        .controls {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid #30363D;
        }

        input {
            background: #0D1117;
            border: 1px solid #30363D;
            color: white;
            padding: 6px;
            border-radius: 4px;
            width: 80px;
        }

        .btn { border: none; padding: 7px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px; }
        .btn-update { background: var(--accent); color: white; }
        .btn-ban { background: var(--danger); color: white; }

        /* Modal pou w√® imaj la an gwo */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--modal-bg);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }
        .modal img { max-width: 95%; max-height: 90%; border-radius: 8px; }
    </style>
</head>
<body>

    <div class="header"><h1>PRIME GAMING HT - ADMIN</h1></div>

    <div class="nav-categories">
        <button onclick="chajKategori('admin_requests/deposits', 'Depo', this)">Depo</button>
        <button onclick="chajKategori('admin_requests/withdrawals', 'Retr√®', this)">Retr√®</button>
        <button onclick="chajKategori('admin_requests/match_results', 'Pr√®v Match', this)">Pr√®v Match</button>
        <button onclick="chajKategori('users', 'Users', this)">Users</button>
        <button onclick="chajKategori('chat', 'Chat', this)">Chat</button>
    </div>

    <div id="display-area"></div>

    <div id="imgModal" class="modal" onclick="this.style.display='none'">
        <img id="fullImg">
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCHVG_0BCd0V_lFSmg3_2qyC5rKclG-b0M",
            authDomain: "prime-gaming-ht.firebaseapp.com",
            databaseURL: "https://prime-gaming-ht-default-rtdb.firebaseio.com",
            projectId: "prime-gaming-ht"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.viewImage = (url) => {
            document.getElementById('fullImg').src = url;
            document.getElementById('imgModal').style.display = 'flex';
        }

        window.updateBalance = (uid) => {
            const val = document.getElementById(`input-${uid}`).value;
            if(!val) return alert("Mete yon val√®");
            update(ref(db, `users/${uid}`), { balance: Number(val) })
            .then(() => alert("Balans ajou!"));
        }

        window.toggleBan = (uid, currentRole) => {
            const newRole = currentRole === 'banned' ? 'player' : 'banned';
            if(confirm(`√àske w vle ${newRole === 'banned' ? 'BLOKE' : 'DEBLOKE'} jw√® sa a?`)) {
                update(ref(db, `users/${uid}`), { role: newRole });
            }
        }

        window.chajKategori = (path, tit, btn) => {
            document.querySelectorAll('.nav-categories button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            const area = document.getElementById('display-area');
            area.innerHTML = "<p style='text-align:center'>Ap chaje...</p>";

            onValue(ref(db, path), (snapshot) => {
                area.innerHTML = `<h3 style="color:var(--primary)">${tit}</h3>`;
                if(!snapshot.exists()) return area.innerHTML += "<p>Pa gen done.</p>";

                snapshot.forEach((child) => {
                    const data = child.val();
                    const key = child.key;
                    let html = "";

                    // Lojik pou jwenn imaj la (kit se proof_img oswa photoUrl)
                    const imajK√≤r√®k = data.proof_img || data.photoUrl || "";
                    const displayImaj = imajK√≤r√®k ? `<img src="${imajK√≤r√®k}" class="img-preview" onclick="viewImage('${imajK√≤r√®k}')">` : "";

                    if(tit === "Users") {
                        const isBanned = data.role === 'banned';
                        html = `
                            <div class="card" style="${isBanned ? 'border-color:var(--danger)' : ''}">
                                <div class="user-header">
                                    <img src="${data.photoUrl || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}" class="profile-pic">
                                    <b>${data.username} ${isBanned ? 'üö´' : ''}</b>
                                </div>
                                <div class="info">
                                    Email: ${data.email || 'N/A'}<br>
                                    Tel: ${data.phone || 'N/A'}<br>
                                    Balans: <span class="amount">${data.balance || 0} HTG</span>
                                </div>
                                <div class="controls">
                                    <input type="number" id="input-${key}" placeholder="Balans">
                                    <button class="btn btn-update" onclick="updateBalance('${key}')">OK</button>
                                    <button class="btn btn-ban" onclick="toggleBan('${key}', '${data.role}')">
                                        ${isBanned ? 'Unban' : 'Ban'}
                                    </button>
                                </div>
                            </div>`;
                    } else {
                        // Pou Depo ak Pr√®v Match
                        html = `
                            <div class="card">
                                <b>Utilisat√®: ${data.username}</b>
                                <div class="info">
                                    Status: ${data.status}<br>
                                    ${data.amount ? `Montan: <span class="amount">${data.amount} HTG</span><br>` : ''}
                                    ${data.match_id ? `Match: ${data.match_id}` : ''}
                                </div>
                                ${displayImaj}
                            </div>`;
                    }
                    area.innerHTML += html;
                });
            });
        }
    </script>
</body>
</html>
